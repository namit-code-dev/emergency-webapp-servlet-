# Use Tomcat 9 with Java 17
FROM tomcat:9.0-jdk17-temurin

# Set working directory
WORKDIR /usr/local/tomcat

# Remove default Tomcat apps
RUN rm -rf webapps/*

# Copy your webapp (HTML, JSP, WEB-INF, etc.)
COPY webapp/ webapps/ROOT/

# Copy servlet source files
COPY src/main/java/ webapps/ROOT/WEB-INF/src/

# Compile Java servlet files inside container
RUN javac -cp "lib/servlet-api.jar" \
    -d webapps/ROOT/WEB-INF/classes \
    $(find webapps/ROOT/WEB-INF/src -name "*.java")

# Expose default Tomcat port
EXPOSE 8080

# Start Tomcat
CMD ["catalina.sh", "run"]
